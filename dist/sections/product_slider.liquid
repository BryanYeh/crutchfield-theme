{% if section.settings.collection_text != blank %}
    <div class="px-4 mx-auto text-center">
        <h2 class="font-semibold text-3xl underline">{{ section.settings.collection_text }}</h2>
    </div>  
{% endif %}

<div class="swiper-container container pt-4" id="swiper-container-{{ section.id }}">
    <div class="swiper-wrapper">
        {% for product in collections[section.settings.collection_set].products limit:section.settings.product_limit %}
            <div class="swiper-slide border border-gray-400 bg-white p-4 hover:border-red-500 flex flex-col group"
                    data-handle="{{ product.handle }}"
                    data-id="{{ product.first_available_variant.id }}">
                <div class="h-full"> 
                    <a href="{{ product.url | within: collection }}" class="">
                        <img src="{{ product.featured_image.src | img_url: '500x500' }}" alt="{{ product.featured_image.alt | escape }}" class="w-full">
                        <div class="font-bold text-lg group-hover:text-red-600 py-2">{{ product.title }}</div>
                    </a>
                    <div class="sku">{% if product.sku %}Item #: {{ product.sku }}{% endif %}</div>
                </div>

                {% if product.available %}
                    <div><i class="availability las la-check-circle"></i> <span class="availability_text">In Stock<span></div>
                {% else %}
                    <div><i class="availability las la-times-circle"></i> <span class="availability_text">Out of Stock<span></div>
                {% endif %}

                <div class="text-right"> 
                    <div class="text-gray-700 line-through text-sm">
                        {% if product.compare_at_price %}
                            {{ product.compare_at_price | money }}
                        {% endif %}
                    </div>
                    <div class="text-red-600">
                        {% if product.compare_at_price %}
                            {{ product.compare_at_price | minus:product.price | money }} Discount
                        {% endif %}
                    </div>
                    <div class="font-bold text-lg">{{ product.price | money }}</div>
                </div>

                {% unless product.has_only_default_variant %}
                    {% for option in product.options %}
                        <label for="variation-select-{{ option | downcase }}">{{ option }}</label>
                            <select name="" id="variation-select-{{ option | downcase }}" class="variation-select border border-gray-500 p-2 focus:outline-none focus:shadow-outline focus:border-blue-200">
                            {% for option_value in product.options_by_name[option].values %}
                                <option value="{{ option_value }}">{{ option_value }}</option>
                            {% endfor %}
                        </select>
                    {% endfor %}
                {% endunless %}

                {% if product.available %}
                    <button class="add-to-cart border border-red-600 bg-red-600 text-white hover:bg-white hover:text-red-600 w-full px-3 py-2 mt-2">Add to Cart</button>
                {% else %}
                    <button class="border border-red-600 bg-white text-red-600 cursor-not-allowed w-full px-3 py-2 mt-2">Sold Out</button>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
</div>

<script defer type="module">
    let swiper_{{ section.id }} = new Swiper('#shopify-section-{{ section.id }} .swiper-container', {
        loop: true,
        navigation: {
            nextEl: '#shopify-section-{{ section.id }} .swiper-button-next',
            prevEl: '#shopify-section-{{ section.id }} .swiper-button-prev',
        },
        slidesPerView: 1,
        spaceBetween: 16,
        breakpoints: {
            1280: {
                slidesPerView: 4,
                spaceBetween: 16
            },
            1024: {
                slidesPerView: 3,
                spaceBetween: 16
            },
            640: {
                slidesPerView: 2,
                spaceBetween: 16
            }
        }
    })
</script>

{% schema %}
    {
        "name": "Products Slider",
        "class": "p-4",
        "settings": [
            {
                "type": "collection",
                "id": "collection_set",
                "label": "Collection"
            },
            {
                "type": "text",
                "id": "collection_text",
                "label": "Header",
                "default": "Featured Products"
            },
            {
                "type": "range",
                "id": "product_limit",
                "min": 4,
                "max": 16,
                "step": 4,
                "label": "Limit",
                "default": 4
            }
        ],
        "presets": [
            {
                "name": "Product",
                "category": "Products"
            }
        ]
    }
{% endschema %}